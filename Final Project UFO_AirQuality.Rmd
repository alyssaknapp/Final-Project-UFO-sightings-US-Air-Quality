---
title: "R Notebook"
author: "Alyssa Knapp"
date: "12/10/20" 
output: html_notebook
---

# Final Project: UFO Sightings & U.S. Air Quality 

## Link to GitHub



## Research Question

Where are UFO sightings in the United States associated with pollutant levels of carbon monoxide (CO) and nitrogen dioxide (NO2) and how do these levels change over time? 


## Purpose

This topic is important to investigate because there is currently very little knowledge of how climate information relates to UFO sightings. Air quality, in particular, is interesting to explore because air pollutants can impair visibility, which may affect the ability of UFOs to be seen in the sky. This "relationship" is expected to become more polarized over time, as air quality worsens. 


## Data Access

```{r, warning = FALSE, message = FALSE}
library(mosaic)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(knitr)
library(lubridate)
library(readxl)
library(DataComputing)
library(plotly)
library(sf)
```

```{r}
rm(list=ls())
```

```{r, warning = FALSE, message = FALSE}
#Data Set 1
UFO <- read_excel("UFOs_coord.xlsx")
```

```{r, warning = FALSE, message = FALSE}
#Data Set 2
AirQ <- read.csv("UFOPOLLUTANTS.csv", header = TRUE)
```


## Inspecting Data Sets

```{r, warning = FALSE, message = FALSE}
#Data Set 1
kable(head(UFO))
glimpse(UFO)
str(UFO)
```

```{r, warning = FALSE, message = FALSE}
#Data Set 2
kable(head(AirQ))
glimpse(AirQ)
str(AirQ)
```


## Variables To Be Used (originally included in data sets)

Data Set 1
* country: will limit to only include USA
* state: records data from certain states 

Data Set 2 
* state: records data from certain states
* month: all 12 months
* year: contains data from 2000 to 2008

* NO2/CO Mean: mean concentration within a given day
* NO2/CO AQI: Air quality index within a given day
* NO2/CO 1st Max Value: maximum value obtained within a given day
* NO2/CO 1st Max Hour: the hour when the maximum concentration was obtained
* ET: equal to 1 if a UFO was sighted, 0 otherwise (binary)


## Data Cleaning & Wrangling for Data Set 1

```{r, warning = FALSE, message = FALSE}
#Limiting to USA only
UFO_US <- 
  UFO %>%
  filter(Country == "USA") 

UFO_US$State <- unlist(lapply(UFO_US$State, tolower))
str(UFO_US)
```


```{r, warning = FALSE, message = FALSE}
#Creating Regions
UFO_US <- 
  UFO_US %>%
  mutate(Region = ifelse(State %in% c("me","nh","vt","ri","ct","ny","pa","nj"), "Northeast",
  ifelse(State %in% c("wi","mi","il","oh","nd","sd","ne","ks","mn","ia","mo"),"Midwest", ifelse(State %in% c("de","md","va","wv","nc","sc","ga","fl","ky","ms","al","ok","tx","ar","la"), "South", "West"))))

Region_count <- 
  UFO_US %>%
  group_by(Region) %>%
  summarise(total = count(State))
  
Region_count
```


## Data Wrangling for Data Set 2

```{r, warning = FALSE, message = FALSE}
#Converting variable types
Air_Q <- 
  AirQ %>% 
  mutate(time = make_datetime(year, month, day, hour),
  day = factor(day(time)),
  month = factor(month(time)),
  year = factor(year(time)),
  weekday = factor(wday(time)),
  hour = factor(hour(time)),
  date = as.Date(time))

names(Air_Q)[names(Air_Q) == "time"] <- "date_time"

#"date" variable is not needed since "date_time" contains the date & time
Air_Q$date <- NULL

kable(head(Air_Q))
```

```{r, warning = FALSE, message = FALSE}
#Filter to only include UFO sightings
Air_Q <- 
  Air_Q %>%
  filter(ET == 1)
  
#Add labels
Air_Q$month <- factor(Air_Q$month, labels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep","Oct", "Nov", "Dec"))
Air_Q$weekday <- factor(Air_Q$weekday,labels = c("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"))
str(Air_Q)
```


```{r, warning = FALSE, message = FALSE}
#Gather pollutants
AirQ_long <-
  Air_Q %>%
  gather(key = pollutants, value = value, NO2.Mean:CO.AQI)

kable(head(AirQ_long))
```



## Joining the 2 Data Sets

```{r, warning = FALSE, message = FALSE}
Join <- left_join(UFO_US %>% group_by(State) %>% mutate(id = row_number()), 
                    AirQ_long %>% group_by(state) %>% mutate(id = row_number()), 
                    by = c("State" = "state", "id"))

#Select only corresponding variables
Joined <- 
  Join %>%
  select(Country, State, Region, day, month, year, hour, ET, date_time, weekday, pollutants, value)
```

```{r, warning = FALSE, message = FALSE}
#Remove Missing Cases from Joined table
UFO_AirQ <- na.omit(Joined, cols = "day", "month", "year", "hour", "ET", "date_time", "weekday", "pollutants", "value")
UFO_AirQ[!complete.cases(UFO_AirQ), ]

kable(head(UFO_AirQ))
```

```{r, warning = FALSE, message = FALSE}
NO2 <- 
  UFO_AirQ %>%
  filter(pollutants %in% c('NO2.Mean', 'NO2.1st.Max.Value', 'NO2.1st.Max.Hour', 'NO2.AQI')) %>%
  select(pollutants, date_time, year, month, weekday, hour, value, Region, State, ET)

NO2$value <- as.integer(as.factor(NO2$value))
str(NO2)
```

```{r, warning = FALSE, message = FALSE}
CO <- 
  UFO_AirQ %>%
  filter(pollutants %in% c('CO.Mean', 'CO.1st.Max.Value', 'CO.1st.Max.Hour', 'CO.AQI')) %>%
  select(pollutants, date_time, year, month, weekday, hour, value, Region, State, ET)

CO$value <- as.integer(as.factor(CO$value))
str(CO)
```


```{r, warning = FALSE, message = FALSE}
#Capitalizing important variables: Pollutants, States & Regions
NO2_capital <-
  data.frame(lapply(NO2,function(v){
  if (is.character(v)) return(toupper(v))
  else return(v)
}))

CO_capital <-
  data.frame(lapply(CO,function(v){
  if (is.character(v)) return(toupper(v))
  else return(v)
}))

NO2_capital
CO_capital
```


## Exploring Data 

```{r, warning = FALSE, message = FALSE}
#Find Mean for NO2
total <- NULL
mean_NO2 <- NULL
for(i in 1:length(NO2_capital$value)) {
  total <- sum(total, NO2_capital$value[i])
}
mean_NO2 <- total/length(NO2_capital$value)

mean_NO2
```


```{r, warning = FALSE, message = FALSE}
#Find Mean for CO
total <- NULL
mean_CO <- NULL
for(i in 1:length(CO_capital$value)) {
  total <- sum(total, CO_capital$value[i])
}
mean_CO <- total/length(CO_capital$value)

mean_CO
```

```{r, warning = FALSE, message = FALSE}
min(NO2_capital$value)
max(NO2_capital$value)
median(NO2_capital$value)

min(CO_capital$value)
max(CO_capital$value)
median(CO_capital$value)
```



```{r, warning = FALSE, message = FALSE}
#Pollutant measurements for each region
Regions_NO2 <-
  NO2_capital %>%
  group_by(Region) %>%
  summarise(count1 = sum(value)) %>%
  arrange(desc(count1))

Regions_CO <-
  CO_capital %>%
  group_by(Region) %>%
  summarise(count2 = sum(value)) %>%
  arrange(desc(count2))

Regions_NO2
Regions_CO
```

```{r, warning = FALSE, message = FALSE}
#Pollutant measurements for recorded states
State_NO2 <- 
  NO2_capital %>%
  group_by(State) %>%
  summarise(count1 = sum(value)) %>%
  arrange(desc(count1))

State_CO <- 
  CO_capital %>%
  group_by(State) %>%
  summarise(count2 = sum(value)) %>%
  arrange(desc(count2))

State_NO2
State_CO
```

```{r, warning = FALSE, message = FALSE}
#UFO sightings for the years 2000 to 2008
Year_NO2 <-
  NO2_capital %>%
  group_by(year) %>%
  summarise(UFOs_1 = count(ET)) %>%
  arrange(desc(UFOs_1))

Year_CO <- 
  CO_capital %>%
  group_by(year) %>%
  summarise(UFOs_2 = count(ET)) %>%
  arrange(desc(UFOs_2))

Year_NO2
Year_CO
```


## Data Visualization

## For NO2

```{r, warning = FALSE, message = FALSE}
NO2_years <- 
    NO2_capital %>%
    group_by(pollutants, year) %>%
    summarise(avg = mean(value)) %>%
    ggplot(aes(x = year, y = avg, color = pollutants)) +
    geom_point(alpha=0.2) + geom_line(aes(group = pollutants)) 

NO2_years
```

```{r, warning = FALSE, message = FALSE}
NO2_boxplot <-
  NO2_capital %>%
  ggplot(aes(y = value, x = year)) +
  geom_boxplot(aes(fill = pollutants),
               notch = TRUE) 

NO2_boxplot
```

```{r, warning = FALSE, message = FALSE}
NO2_months <- 
  NO2_capital %>%
    group_by(pollutants, month) %>%
    summarise(avg = mean(value)) %>% 
    ggplot(aes(x = month, y = avg, fill = pollutants)) +
    geom_bar(stat="identity", position="dodge") 

NO2_months
```

```{r, warning = FALSE, message = FALSE}
str(NO2_capital)

NO2_capital$hour <- as.integer(NO2_capital$hour)

NO2_smooth <- 
  NO2_capital %>%
  group_by(pollutants, hour) %>%
  summarise(avg = mean(value)) %>%
  ggplot(aes(x = hour, y = avg, color = pollutants)) + 
  geom_point() + 
  geom_smooth() 

NO2_smooth
```

```{r, warning = FALSE, message = FALSE}
NO2_gradient <- 
  NO2_capital %>%
  filter(pollutants!="NO2.AQI") %>%
  ggplot(aes(x = month, y = year, fill = value)) + 
  geom_tile(color = "white") + scale_fill_gradient(low ="blue", high ="green") + ggtitle("NO2 Mean")

NO2_gradient
```

```{r, warning = FALSE, message = FALSE}
NO2_gradient2 <- 
  NO2_capital %>%
  filter(pollutants!="NO2.Mean") %>%
  ggplot(aes(x = month, y = year, fill = value)) + 
  geom_tile(colour = "white") + scale_fill_gradient(low ="blue", high ="green") + ggtitle("NO2 AQI")

NO2_gradient2
```



## For CO

```{r, warning = FALSE, message = FALSE}
CO_years <- 
    CO_capital %>%
    group_by(pollutants, year) %>%
    summarise(avg = mean(value)) %>%
    ggplot(aes(x = year, y = avg, color = pollutants)) +
    geom_point(alpha=0.2) + geom_line(aes(group = pollutants)) 

CO_years
```


```{r, warning = FALSE, message = FALSE}
CO_boxplot <-
  CO_capital %>%
  ggplot(aes(y = value, x = year)) +
  geom_boxplot(aes(fill = pollutants),
               notch = TRUE) 

CO_boxplot
```

```{r, warning = FALSE, message = FALSE}
CO_months <- 
  CO_capital %>%
    group_by(pollutants, month) %>%
    summarise(avg = mean(value)) %>% 
    ggplot(aes(x = month, y = avg, fill = pollutants)) +
    geom_bar(stat="identity", position="dodge") 

CO_months
```

```{r, warning = FALSE, message = FALSE}
CO_capital$hour <- as.integer(as.factor(CO_capital$hour))

CO_smooth <-
  CO_capital %>%
  group_by(pollutants, hour) %>%
  summarise(avg = mean(value)) %>%
  ggplot(aes(x = hour, y = avg, color = pollutants)) +
  geom_point() +
  geom_smooth()

CO_smooth
```

```{r, warning = FALSE, message = FALSE}
CO_gradient <- 
  CO_capital %>%
  filter(pollutants!="CO.AQI") %>%
  ggplot(aes(x = month, y = year, fill = value)) + 
  geom_tile(color = "white") + scale_fill_gradient(low ="blue", high ="green") + ggtitle("CO Mean")

CO_gradient
```

```{r, warning = FALSE, message = FALSE}
CO_gradient2 <- 
  CO_capital %>%
  filter(pollutants!="CO Mean") %>%
  ggplot(aes(x = month, y = year, fill = value)) + 
  geom_tile(color = "white") + scale_fill_gradient(low ="blue", high ="green") + ggtitle("CO AQI")

CO_gradient2
```



## For NO2 & CO

```{r, warning = FALSE, message = FALSE}
#Combining NO2 & CO data frames
NO2_CO <- 
  rbind(NO2_capital, CO_capital)
  
kable(head(NO2_CO))
```

```{r}
ggplot(NO2_CO, aes(value, color = pollutants)) + 
  geom_density()
```


```{r, warning = FALSE, message = FALSE, fig.width = 10}
Pollutant_dist <-
  NO2_CO %>%
  ggplot(aes(y = value, x = pollutants)) +
  geom_boxplot(aes(fill = Region)) +
  geom_jitter() + 
  ggtitle("Distribution of NO2 & CO values in U.S. regions")

Pollutant_dist
```


```{r, fig.width = 10}
Pollutants_Regions <- ggplot(data = NO2_CO, aes(x = year,y = value, fill = Region)) + geom_bar(stat ='identity', position ='stack', width =.9)+ facet_wrap(~pollutants, ncol = 3) + ggtitle("NO2 & CO pollutant levels in U.S. regions over time") + theme(axis.text.x = element_text(angle = 60, hjust = 1))

Pollutants_Regions
```


```{r, fig.height = 8, fig.width = 10}
Pollutants_States <- ggplot(data = NO2_CO, aes(x = year, y = value, fill = pollutants)) + geom_bar(stat ='identity', position ='dodge', width =.9)+ facet_wrap(~State, ncol = 3) + theme(axis.text.x = element_text(angle = 60, hjust = 1)) + ggtitle("NO2 & CO pollutant levels in U.S. states over time")

Pollutants_States
```


## Conclusions 





